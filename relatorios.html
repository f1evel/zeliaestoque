<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Zélia — Relatórios</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
<div class="app-container">

  <!-- 🔸 Sidebar -->
  <aside class="sidebar">
    <div class="logo">
      <img src="img/logo-zelia.png" alt="Logo Zélia" />
    </div>
    <nav>
      <ul>
        <li><a href="dashboard.html">🏠 Dashboard</a></li>
        <li><a href="produtos.html">📦 Produtos</a></li>
        <li><a href="movimentacoes.html">🔁 Movimentações</a></li>
        <li><a href="financeiro.html">💰 Financeiro</a></li>
        <li><a class="ativo" href="relatorios.html">📊 Relatórios</a></li>
      </ul>
    </nav>
    <button onclick="logout()">Sair</button>
  </aside>

  <!-- 🔸 Conteúdo Principal -->
  <main class="main-content">
    <h1>📊 Relatórios</h1>

    <!-- 🔥 Abas -->
    <div class="abas">
      <button class="aba ativa" onclick="abrirAba('aba-consumo')">Consumo</button>
      <button class="aba" onclick="abrirAba('aba-entradas')">Entradas</button>
      <button class="aba" onclick="abrirAba('aba-saidas')">Saídas</button>
      <button class="aba" onclick="abrirAba('aba-estoque')">Estoque Crítico</button>
      <button class="aba" onclick="abrirAba('aba-previsao')">Previsão</button>
    </div>

    <!-- 🔥 Aba Consumo -->
    <div id="aba-consumo" class="aba-conteudo">
      <h2>📦 Relatório de Consumo</h2>
      <p class="descricao-relatorio">Exibe o consumo mensal de produtos, permitindo
        análise por categoria, fornecedor e tendência ao longo do tempo.</p>

      <!-- 🔍 Filtros -->
      <div class="filtros">
        <input type="text" id="filtro-nome-consumo" placeholder="🔍 Produto..." list="sugestoes-produtos">
        <datalist id="sugestoes-produtos"></datalist>

        <select id="filtro-categoria-consumo"></select>
        <select id="filtro-fornecedor-consumo"></select>
        <select id="filtro-mes-consumo"></select>

        <button id="botao-limpar-consumo">🧹 Limpar</button>
        <button id="botao-exportar-csv-consumo">📄 CSV</button>
        <button id="botao-exportar-excel-consumo">📊 Excel</button>
        <button id="botao-exportar-pdf-consumo">🖨️ PDF</button>
      </div>

      <!-- 📊 Cards -->
      <div id="cards-consumo" class="cards">
        <div class="card"><strong>Itens:</strong> <span id="card-consumo-itens">-</span></div>
        <div class="card"><strong>Categorias:</strong> <span id="card-consumo-categorias">-</span></div>
        <div class="card"><strong>Fornecedores:</strong> <span id="card-consumo-fornecedores">-</span></div>
        <div class="card"><strong>Quantidade total:</strong> <span id="card-consumo-quantidade">-</span></div>
      </div>

      <!-- 📈 Gráficos -->
      <canvas id="grafico-consumo-mes" style="max-height: 300px; margin: 20px 0;"></canvas>
      <canvas id="grafico-consumo-categoria" style="max-height: 300px; margin: 20px 0;"></canvas>

      <!-- 📋 Tabela -->
      <div id="tabela-consumo"></div>
    </div>

    <!-- 🔥 Aba Entradas -->
    <div id="aba-entradas" class="aba-conteudo" style="display:none">
      <h2>📥 Relatório de Entradas</h2>

      <div class="filtros">
        <label for="filtro-nome-entradas">Produto:</label>
        <input type="text" id="filtro-nome-entradas" placeholder="🔍 Produto..." list="lista-produtos-entradas">
        <datalist id="lista-produtos-entradas"></datalist>

        <label for="filtro-fornecedor-entradas">Fornecedor:</label>
        <select id="filtro-fornecedor-entradas"></select>

        <label for="filtro-compra-entradas">Compra:</label>
        <select id="filtro-compra-entradas"></select>

        <label for="filtro-data-inicio-entradas">De:</label>
        <input type="date" id="filtro-data-inicio-entradas">
        <label for="filtro-data-fim-entradas">Até:</label>
        <input type="date" id="filtro-data-fim-entradas">

        <button id="botao-limpar-entradas">🧹 Limpar</button>
        <button id="botao-exportar-excel-entradas">📊 Excel</button>
      </div>

      <div id="cards-entradas" class="cards">
        <div class="card"><strong>Valor total:</strong> <span id="card-entradas-valor">-</span></div>
        <div class="card"><strong>Quantidade total:</strong> <span id="card-entradas-quantidade">-</span></div>
      </div>

      <div id="tabela-entradas"></div>
    </div>

    <!-- 🔥 Aba Saídas -->
    <div id="aba-saidas" class="aba-conteudo" style="display:none">
      <h2>📤 Relatório de Saídas</h2>

      <div class="filtros">
        <label for="filtro-nome-saidas">Produto:</label>
        <input type="text" id="filtro-nome-saidas" placeholder="🔍 Produto..." list="lista-produtos-saidas">
        <datalist id="lista-produtos-saidas"></datalist>

        <label for="filtro-categoria-saidas">Categoria:</label>
        <select id="filtro-categoria-saidas"></select>

        <label for="filtro-data-inicio-saidas">De:</label>
        <input type="date" id="filtro-data-inicio-saidas">
        <label for="filtro-data-fim-saidas">Até:</label>
        <input type="date" id="filtro-data-fim-saidas">

        <button id="botao-limpar-saidas">🧹 Limpar</button>
        <button id="botao-exportar-excel-saidas">📊 Excel</button>
      </div>

      <div id="tabela-saidas"></div>
    </div>



    <!-- 🔥 Aba Estoque -->
    <div id="aba-estoque" class="aba-conteudo" style="display: none;">
      <h2>🚨 Itens em Alerta (Crítico + Validade Próxima)</h2>

      <div class="filtros">
        <input type="text" id="filtro-nome-estoque" placeholder="🔍 Produto...">
        <select id="filtro-alerta-tipo" style="width:160px;">
          <option value="todos">Mostrar: Todos</option>
          <option value="critico">Apenas estoque crítico</option>
          <option value="validade">Apenas validade próxima</option>
        </select>
        <select id="filtro-categoria-estoque"></select>
        <select id="filtro-fornecedor-estoque"></select>
        <label><input type="checkbox" id="filtro-lote-ativo"> Lote ativo</label>
        <label>Dias p/ vencer:</label>
        <input type="number" id="input-dias-val" value="15" min="1" style="width: 60px;">
        <button id="botao-atualizar-estoque">🔄 Atualizar</button>
        <button id="botao-limpar-estoque">🧹 Limpar</button>
        <button id="botao-exportar-csv-estoque">📄 CSV</button>
        <button id="botao-exportar-excel-estoque">📊 Excel</button>
        <button id="botao-exportar-pdf-estoque">🖨️ PDF</button>
        <button id="botao-gerar-pedido">🛒 Gerar pedido automático</button>
      </div>

      <div id="cards-estoque" class="cards">
        <div class="card"><strong>Itens em alerta:</strong> <span id="card-estoque-alerta">-</span></div>
      </div>
      <canvas id="grafico-estoque"></canvas>
      <div id="tabela-estoque"></div>
    </div>

    <!-- 🔥 Aba Previsão -->
    <div id="aba-previsao" class="aba-conteudo" style="display: none;">
      <h2>🔮 Previsão de Esgotamento</h2>

      <div class="filtros">
        <input type="text" id="filtro-nome-previsao" placeholder="🔍 Produto...">
        <select id="filtro-categoria-previsao"></select>
        <label>Período base (meses):</label>
        <input type="number" id="input-meses-previsao" value="3" min="1" style="width: 60px;">
        <label><input type="checkbox" id="check-apenas-critico"> Somente críticos</label>
        <input type="number" id="input-limite-previsao" value="30" min="1" style="width:60px"> dias
        <button id="botao-atualizar-previsao">🔄 Atualizar</button>
        <button id="botao-limpar-previsao">🧹 Limpar</button>
        <button id="botao-exportar-csv-previsao">📄 CSV</button>
        <button id="botao-exportar-excel-previsao">📊 Excel</button>
        <button id="botao-exportar-filtrado-previsao">⏬ Exportar Críticos</button>
      </div>

      <div id="cards-previsao"></div>
      <canvas id="grafico-previsao"></canvas>
      <div id="tabela-previsao"></div>
    </div>

  </main>
</div>

<!-- 🔥 Spinner -->
<div id="spinner" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
background:#ffffffcc; z-index:2000; display:flex; align-items:center; justify-content:center;">
  <div style="border:6px solid #ccc; border-top:6px solid #009688; border-radius:50%; width:40px; height:40px;
  animation:girar 1s linear infinite;"></div>
</div>

<style>
@keyframes girar {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>

<!-- 🔥 Firebase e Utilitários -->
<script type="module" src="js/firebaseConfig.js"></script>
<script type="module" src="js/utils.js"></script>
<script type="module" src="js/modais.js"></script>

<!-- 🔥 Relatórios -->
<script type="module" src="js/relatorios/consumo.js"></script>
<script type="module" src="js/relatorios/consumoExportar.js"></script>
<script type="module" src="js/relatorios/consumoGraficos.js"></script>
<script type="module" src="js/relatorios/consumoTotais.js"></script>
<script type="module" src="js/relatorios/consumoTabela.js"></script>

<script type="module" src="js/relatorios/entradas.js"></script>
<script type="module" src="js/relatorios/entradasExportar.js"></script>
<script type="module" src="js/relatorios/entradasTabela.js"></script>
<script type="module" src="js/relatorios/entradasDados.js"></script>

<script type="module" src="js/relatorios/saidas.js"></script>
<script type="module" src="js/relatorios/saidasExportar.js"></script>
<script type="module" src="js/relatorios/saidasTabela.js"></script>
<script type="module" src="js/relatorios/saidasDados.js"></script>


<script type="module" src="js/relatorios/estoque.js"></script>
<script type="module" src="js/relatorios/estoqueExportar.js"></script>
<script type="module" src="js/relatorios/estoqueGraficos.js"></script>
<script type="module" src="js/relatorios/estoqueTotais.js"></script>

<script type="module" src="js/relatorios/previsao.js"></script>
<script type="module" src="js/relatorios/previsaoExportar.js"></script>
<script type="module" src="js/relatorios/previsaoGraficos.js"></script>
<script type="module" src="js/relatorios/previsaoTotais.js"></script>

<!-- 🔸 Controle das abas -->
<script>
  function abrirAba(id) {
    document.querySelectorAll('.aba').forEach(btn => btn.classList.remove('ativa'));
    document.querySelectorAll('.aba-conteudo').forEach(div => div.style.display = 'none');
    document.querySelector(`[onclick="abrirAba('${id}')"]`).classList.add('ativa');
    document.getElementById(id).style.display = 'block';
    if(id === 'aba-estoque' && window.atualizarTabelaEstoque){
      window.atualizarTabelaEstoque();
    }
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>
</html>
